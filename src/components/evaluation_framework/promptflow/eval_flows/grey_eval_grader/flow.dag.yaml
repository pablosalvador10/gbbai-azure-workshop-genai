$schema: https://azuremlschemas.azureedge.net/promptflow/latest/Flow.schema.json
environment:
  python_requirements_txt: requirements.txt
inputs:
  generated_question:
    type: string
    default: How can I reduce my energy bill without sacrificing comfort?
  gt_response:
    type: string
    default: To lower your energy bill during the winter months, you can take
      several steps. These include setting your thermostat to a lower
      temperature when you're not at home or when you're asleep, using a
      programmable thermostat to manage heating more efficiently, sealing any
      air leaks in your home, ensuring your home is properly insulated, using
      energy-efficient heating sources, and using curtains or blinds to keep
      heat in during the night.
  user_response:
    type: string
    default: To lower your energy bill during the winter months, you can set your
      thermostat to a lower temperature when you're not at home or when you're
      asleep. You can also use curtains or blinds to keep heat in during the
      night.
  evaluation:
    type: string
    default: <table>\n                    <tr>\n                        <th>Criteria</th>\n                        <th>Score</th>\n                        <th>Feedback</th>\n                    </tr>\n                    <tr>\n                        <td>Factual
      Accuracy</td>\n                        <td>3</td>\n                        <td>The
      response is partially accurate, but it could be improved by including more
      energy-saving tips such as sealing air leaks and using programmable
      thermostats.</td>\n                    </tr>\n                    <tr>\n                        <td>Clarity</td>\n                        <td>4</td>\n                        <td>The
      response is clear and easy to
      understand.</td>\n                    </tr>\n                </table>
  evaluation_score:
    type: int
    default: 3
outputs:
  output:
    type: string
    reference: ${concat_scores.output}
nodes:
- name: embed_gt
  type: python
  source:
    type: package
    tool: promptflow.tools.embedding.embedding
  inputs:
    connection: aoai-connection
    deployment_name: victor-ada2
    input: ${inputs.gt_response}
- name: embed_user_response
  type: python
  source:
    type: package
    tool: promptflow.tools.embedding.embedding
  inputs:
    connection: aoai-connection
    deployment_name: victor-ada2
    input: ${inputs.user_response}
- name: cosine_similarity
  type: python
  source:
    type: code
    path: cosine_similarity.py
  inputs:
    vectorA: ${embed_gt.output}
    vectorB: ${embed_user_response.output}
- name: check_grade
  type: python
  source:
    type: code
    path: validate_grade.py
  inputs:
    cosine_sim: ${cosine_similarity.output}
    evaluation_score: ${inputs.evaluation_score}
- name: html_check
  type: python
  source:
    type: code
    path: html_check.py
  inputs:
    html_string: ${inputs.evaluation}
- name: concat_scores
  type: python
  source:
    type: code
    path: concat_scores.py
  inputs:
    grade_accuracy: ${check_grade.output}
    html_format: ${html_check.output}
    evaluation_score: ${inputs.evaluation_score}
    cosine_sim: ${cosine_similarity.output}
